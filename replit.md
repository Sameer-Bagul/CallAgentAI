# AI Calling Agent Platform

## Overview
This project is an AI-powered calling platform designed for automated outbound calls with AI conversation capabilities, real-time monitoring, and comprehensive call management. Its core purpose is to enable businesses to conduct automated campaigns, such as recruiting pathology labs as partners, using AI-driven conversations. The platform features a React-based dashboard for monitoring and managing calls, leveraging AI and telephony services for seamless interaction. The business vision is to act as a neutral aggregator platform connecting laboratories across India, offering a zero-commission model to foster transparency and bridge the gap between people seeking tests and labs offering diagnostics. It aims to scale by partnering with numerous laboratories and expanding its user base.

## User Preferences
Preferred communication style: Simple, everyday language.

## System Architecture

### Frontend Architecture
The frontend is built with React 18 and TypeScript, utilizing Shadcn/ui components (based on Radix UI) for the UI and Tailwind CSS for styling. State management is handled by TanStack Query, and Wouter is used for lightweight client-side routing. Vite serves as the build tool, and WebSocket integration provides real-time updates for live call statuses.

### Backend Architecture
The backend is powered by Node.js with the Express.js framework, written in TypeScript. It features RESTful API endpoints with structured error handling and a WebSocket server for broadcasting call events. Development leverages TSX for hot reloading, and ESBuild is used for production bundling.

### Database & ORM
PostgreSQL is the chosen database, hosted on Neon for serverless capabilities. Drizzle ORM provides type-safe schema definitions and is used with Drizzle Kit for migrations and schema management. Connection pooling is managed by `@neondatabase/serverless`. The schema includes comprehensive tables for users, contacts, campaigns, calls, and call messages.

### AI Integration
OpenAI is integrated for generating conversations. The system manages conversation history and campaign prompts, processes structured JSON responses for call flow control, and automatically extracts data points from conversations. The AI model is specifically updated to understand Hinglish, with contextual examples for broken speech patterns and temperature reduced to 0.3 for consistency. It is configured to recruit pathology labs as partners for LabsCheck - India's first diagnostic aggregator platform. The AI follows a structured conversation flow: opening with lab owner verification, handling non-owner scenarios by collecting contacts, explaining LabsCheck's mission of trusted diagnostics at affordable prices through NABL accredited lab partnerships, offering trusted partner listing with login portal access, and closing by requesting WhatsApp/email for official information sharing.

### Telephony Integration
Twilio is used for all voice call and telephony services, handling automated call initiation, status tracking, and call recording. TwiML webhooks are utilized for managing call events. The system employs Twilio's speech recognition enhanced for Indian languages (hi-IN), with extended timeouts and specific hints for lab-related terms.

### Enhanced Voice Processing Pipeline
A sophisticated voice processing pipeline is implemented for seamless conversations using the FreshConversationService. This includes audio format auto-detection (WAV/MP3/default) for proper OpenAI Whisper compatibility, language auto-detection (Hindi/English/Hinglish), and voice matching with ElevenLabs Aavika voice synthesis. The system eliminates interrupting prompts, ensuring a continuous flow from recording to Whisper transcription, GPT-4o processing, language-matched TTS, and playback. Fixed critical ES module compatibility issues with process.cwd() for temp file handling. All conversation loops use the fresh-recording webhook for reliable audio processing.

#### Natural Conversation Flow Enhancement
Added typing sound effects between customer speech and AI responses to eliminate awkward silence gaps. The system plays a subtle "..." audio generated by ElevenLabs using Adam voice with minimal settings before each AI response. This creates a natural conversation feel where the AI appears to be "thinking" or "typing" before responding, similar to human conversation patterns. The typing sound is cached to avoid regenerating and uses graceful fallback if unavailable.

### Authentication & Security
Session management is handled by Express sessions with PostgreSQL storage. Environment variables securely manage credentials, Zod schemas enforce input validation, and comprehensive error boundaries and logging are in place.

### Real-time Features
A WebSocket server facilitates bi-directional communication, broadcasting live call status updates and metrics to connected clients for real-time dashboard monitoring. The system includes automatic reconnection and error handling for robust real-time performance.

### Development & Build
The project emphasizes type safety with full TypeScript coverage. Development benefits from hot reloading (Vite HMR for frontend, TSX for backend) and organized imports via path aliases. The monorepo structure ensures shared schema and types between the client and server.

## Recent Changes (August 6, 2025)

### Campaign Configuration System
- Implemented comprehensive database-driven campaign management system
- Added campaign settings UI with real-time editing and deletion capabilities
- Moved intro lines and agent names from hardcoded values to database configuration
- Fixed foreign key constraint issues for campaign deletion (properly removes associated calls and messages)
- All campaign configurations now instantly available to AI conversation system
- Users can modify intro lines and agent names without technical knowledge through Campaign Settings page

### Voice Configuration & Call Flow Fixes
- Added comprehensive ElevenLabs voice synthesis options to Campaign Settings
- Implemented custom voice support with API integration to fetch user's ElevenLabs voices
- Fixed critical async/await syntax errors in freshConversationService
- Fixed voice ID validation to use existing voices from user's account (Z6TUNPsOxhTPtqLx81EX)
- Updated call initiation to properly use campaign intro lines instead of hardcoded greetings
- Verified typing sound effects work correctly to fill conversation gaps
- All voice parameters (model, stability, similarity boost, style, speaker boost) now configurable per campaign

## External Dependencies

### Core Infrastructure
- **Neon Database**: Serverless PostgreSQL hosting.
- **Replit Hosting**: Development and deployment environment.

### AI & Communication Services
- **OpenAI API**: Used for GPT models, Whisper for speech recognition, and various TTS models (e.g., Nova, Alloy).
- **ElevenLabs**: Premium AI voice synthesis for generating high-quality audio responses.
- **Twilio**: Provides telephony services, including voice calls, recording, and webhook management.
- **Meta Business API**: Integrated for WhatsApp bulk messaging and template management.

### Development Tools
- **Vite Plugins**: For development enhancements.
- **Drizzle Kit**: For database schema management.
- **TanStack Query**: For advanced server state management.